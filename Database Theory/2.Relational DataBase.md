# 一、概述及基本概念

## 1、关系

### 域

域是一组具有**相同数据类型**的值的集合，表示属性的取值范围。

域中包含的值的个数称为域的基数，用m表示。

### 笛卡尔积



### 关系

关系可以看成是一个二维表。每一行对应一个元组，表的每一列对应一个域，每个域起一个名字为属性。

## 2、主码等

候选码(candidate key)

值能够唯一标识一个元组的**属性组**，且不含多余属性。该属性组称为候选码

主码(primary key)

一个关系有**多个候选码**时，选择其中一个作为主码。

外码(foreign key)

关系R的某一属性组X不是R的码，但是是**其他某一关系**的主码，称X为R的外码。

全码(all key)

若关系R**整个属性组**的集合是R的候选码，则该候选码为全码。

## 3、三类关系

基本关系(基本表或基表)

实际存在的表，是实际存储数据的逻辑表示

查询表

查询**结果**对应的表

视图表

由基本表或其他视图表导出的表

## 4、关系的性质

* 每列的值为同一类型
* 每列有不同的属性名(可同域)
* 任意两元组不能完全相同
* 行的次序可以换
* 列的次序可以互换
* 分量值是原子的



# 二、关系模式(relation schema)

关系模式是对关系的描述，也就是关系的框架。

## 1、关系模型的结构

元组集合的结构

* 属性构成
* 属性来自的域
* 属性与域之间的映像关系

关系包括属性名集、域名集、属性和域之间的关系集。

## 2、关系模式的表示

R(U, D, dom, F)

* R为关系名
* U为组成该关系的属性名集合
* D为属性组U中属性所来自的域
* dom指属性向域的映像集合
* F为属性间的数据依赖关系集合

~~~
导师和研究生出自同一个域——人，取不同的属性名，并在模式中定义属性向域的映象
，即说明它们分别出自哪个域：
 dom （ SUPERVISOR-PERSON ）
= dom （ POSTGRADUATE-PERSON ）
= PERSON
~~~

关系模式可以简化为R( U ) or R(A1, A2, A3, ……,An)



## 3、关系模式的完整性

关系的完整性

* 实体完整性
  * 属性 A 是基本关系 R 的主码属性，则属性 A 不能取空值
  * 实体具有唯一性标识—主码，**主码不能为空值**
* 参照完整性
  * 关系中的某属性的值需要参照另一关系的属性来取值
* 用户定义的完整性
  * 是用户需要遵循的约束条件
  * 主要包括属性的取值范围和属性的非空限制

拥有外码的关系称为参照关系，外码作为主码的关系称为被参照关系。

~~~
学生 ( 学号，姓名，性别，专业号，年龄 )
专业 ( 专业号，专业名 )
其中，专业号作为学生关系的外码，但不是学生关系的主码；专业关系是被参照关系，学生关系是参照关系。
参照完整新要求学生关系中专业号要么为空，要么为专业关系中的某个元组的主码值
~~~

## 4、关系的数据操作

常用的关系操作

* 查询
  * 选择、投影、连接、除、并、交、差
* 数据更新
  * 插入、删除、修改



关系操作的特点

* 集合操作方式，即**操作的对象和结果都是集合**

## 5、关系数据语言

是一种高度非过程化的语言。存取路径的选择由DBMS的优化机制来实现，用户不用循环结构就能完成数据操作。

能够嵌入高级语言中使用

# 三、关系代数

主要分为集合运算和关系运算

* 集合运算符

| 运算符 |                 含义                 |
| :----: | :----------------------------------: |
|   U    |              并(Union)               |
|   -    |            差(Difference)            |
|   ∩    |           交(Intersection)           |
|   ×    | 笛卡尔积(Extended Cartesian Product) |

差：R -S = { t |t∈R ∧ t不属于S }

交：R ∩ S = R - (R - S)

广义笛卡尔积: 

R为n目关系，k1个元组；S为m目关系，k2个元组。

笛卡尔积之后生成的是(n + m)个列和k1 * k2个元组。



* 比较运算符

就常用的那些

* 关系运算符

| 运算符 |      含义       |
| :----: | :-------------: |
|   σ    | 选择(Selection) |
|   Π    |  投影(Project)  |
|   ⋈    |     连接()      |
|   ÷    |       除        |

## 选择

是在关系中选择满足给定条件的元组：

σF (R) = {t |t∈R∧F (t )= ' 真 '}

F是选择条件，为一个逻辑表达式

选择是从**行的角度**进行的运算。需要**结合例题**进行理解

## 投影

从关系R中选择出若干属性列组成新的关系。

πA (R) = { t[A] | t ∈R }

投影是从列的角度进行选择。投影之后能够**消除重复的元组**。

## 连接

连接类似于集合运算中的笛卡尔积。但是连接通常有限制条件。

关系R和关系S。trts为元组的连接。R和S分别为n目和m目，连接后为 m + n的关系。

R×S={tr ts| （ tr ∈ R ）∧（ ts ∈ S ） }

R 连接符号 S = { | tr ∈ R ∧ ts ∈ S ∧ tr[A] θ ts[B]}

### 常用连接

等值连接

θ为=时，为等值连接， 即从AB的笛卡尔积中选择AB属性值相等的元组

自然连接

一种特殊的等值连接。两个关系中进行比较的分量必须是**相同的属性组**， 并且在结果中把重复的属性列去掉。即比较的两关系具有相同的属性组B，也就是属性名相等。

## 象集

给定一个关系R(X, Z), X和Z为属性组。当 t[X] = x 时，x在R中的象集(Image Set)为Zx = {t[Z] | t ∈ R， t[X] = x}。**R 中属性组 X 上值为 x 的诸元组在 Z 上分量的集合。**

## 除

给定关系 R (X ， Y) 和 S (Y ， Z ) ，其中 X ， Y ， Z 为属性组。 R 中的 Y 与 S 中的 Y 可以有**不同的属性名，但必须出自相同的域集**。 R 与 S 的除运算得到一个新的关系 P(X) ， P 是 R 中满足下列条件的元组在 X 属性列上的投影： R 中元组在 X 上分量值 x 的象集 Yx 包含 S 在 Y 上投影的集合。

R÷S = {t r [X] | tr ∈ R ∧ πY (S) 子集 Yx }

例子

R

|  A   |  B   |  C   |
| :--: | :--: | :--: |
|  a1  |  b1  |  c2  |
|  a2  |  b3  |  c7  |
|  a3  |  b4  |  c6  |
|  a1  |  b2  |  c3  |
|  a4  |  b6  |  c6  |
|  a2  |  b2  |  c3  |
|  a1  |  b2  |  c1  |

S

| B    | C    | D    |
| ---- | ---- | ---- |
| b1   | c2   | d1   |
| b2   | c1   | d1   |
| b2   | c3   | d2   |

R ÷ S = 

|  A   |  D   |
| :--: | :--: |
|  a1  |  d1  |
|  a1  |  d1  |
|  a1  |  d2  |



* 逻辑运算符

| 运算符 | 含义 |
| :----: | :--: |
|        |  非  |
|   ∧    |  与  |
|   ∨    |  或  |


