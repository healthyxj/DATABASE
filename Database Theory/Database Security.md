# 一、数据库安全性控制

安全措施应该一级一级层层设置。

![](img\计算机系统的安全性.jpg)

## 1、用户标识与鉴别(Identification & Authentication)

这是系统提供的最外层安全保护措施。

基本方法

* 系统提供一定的方式让用户**标识自己的名字或身份**；
  * 利用用户自身具备的各种自然特征标识自己和提供鉴别的依据。 
  * 利用用户持有的证件。 
  * 利用口令。
    * 扩大口令集和口令长度。 
    * 规定口令的生效时间，定期或不定期地更换口令。 
    * 设置多层口令系统。 
    * 设置动态口令。
* 系统内部记录着所有合法用户的标识；
* 每次用户要求进入系统时，由系统核对用户提供的身份标识；
* 通过鉴定后才提供机器使用权；
* 用户标识和鉴定可以重复多次。

## 2、存取控制

数据库安全依赖于数据库系统的访问控制。数据库安全的一部分是**控制物理访问**，另一主要部分是通过 **DBMS 控制访问**。

所有的 DBMS 都包含安全系统，以保证授权用户访问数据库，这些安全机制一般指自主存储控制 （ Discretionary Access Control ， DAC ）和强制存取控制 （ Mandatory Access Control ， MAC ）。

### 自主存取控制DAC

用户对于不同的数据对象有不同的存取权限，不同的用户对同一对象也有不同的权限，而且用户还可将其拥有的存取**权限转授**给其他用户。**任意存取控制非常灵活**

在授予或撤销访问权限时，主要有两种级别

* 数据库对象：数据项或数据元素，一般是基表或视图
* 用户：可以用一些授权标识符识别的单个用户或用户组。

### 强制存取控制MAC

在强制存取控制 (MAC) 方法中，每一个数据对象被标以一定的密级，每一个用户也被授予某一个级别的许可证。 对于任意一个对象，**只有具有合法许可证的用户才可以存取**。 强制存取控制因此相对比较**严格**。MAC 适用于对数据有严格而固定密级分类的部门。

主要对象有

* 主体是指数据库中数据访问者、（用户、 DBA ）进程、线程等 ，是系统中的**活动实体**。 
* 客体是指数据库中数据及其载体（表、视图、索引、存储过程 等），是系统中的**被动实体**。

对于主体和客体， DBMS 为它们每个实例 ( 值 ) 指派一个**敏感度标记 (Label) **。敏感度标记被分成若干级别，例如绝密、机密、可信、公开 等。 主体的敏感度标记称为**许可证级别**。 客体的敏感度标记称为**密级**。

主体子集访问客体子集，**MAC 机制就是通过对比主体的 Label 和客体的 Label **，最终确定主体是否能够存取客体。

当某一主体以标记 label 注册入系统时，系统要求他对任何客体的存取必须遵循如下规则： 

① 仅当主体的许可证级别**大于或等于客体**的密级时，该主体才**能读取相应的客体**； ② 仅当主体的许可证级别**小于或等于客体**的密级时，该主体才**能写相应的客体**。

这两种规则的共同点在于它们均禁止了拥有高许可证级别的主体更新低密级的数据对象，从而防止了敏感数据的泄漏。

### 用户分类和权限

用户 : 系统用户 (DBA) 、数据对象属主 (owner) 、一般用户 、公共用户 (public) 。

权限：包括数据访问权限（读、插入、修改、删除等）和数据库模式修改权限（索引、资源、修改、撤消等）两类。

用户的权限

* **建表（ CREATETAB ）的权限：属于 DBA **
* DBA 授予 --> 普通用户 
* 基本表或视图的属主拥有对该表或视图的一切操作权限 
* 接受权限的用户 : 
  * 一个或多个具体用户 
  * **PUBLIC （全体用户）**

### 授权与收回权限

DBMS 提供了功能强大的授权机制，它可以给用户授予各种不同对象（表、视图、存储过程等）的不同使用权限（如 select, update, insert, delete 等）。

 GRANT 语句向用户授予操作权限

~~~mysql
GRANT< 权限 >[ ， < 权限 >]… 
[ON< 对象类型 >< 对象名 >] 
TO< 用户 >[ ， < 用户 >]... 
[WITH GRANT OPTION]	#可将此权限转授

例：把对表 SC 的 INSERT 权限授给用户 U5 ，并允许将此权限再授予其他用户。

GRANT INSERT
ON TABLE SC
TO U5
WITH GRANT OPTION ； 
~~~



DBMS 实现数据安全性保护的过程 

1. 用户或 DBA 把授权决定告知系统 
2. SQL 的 GRANT 和 REVOKE 
3. DBMS 把授权的结果存入数据字典 
4. 当用户提出操作请求时， DBMS 根据授权定义进行检查，以决定 是否执行操作请求

~~~mysql
例 2 把对 Student 表的全部权限授予用户 U2 和U3.

GRANT ALL PRIVILEGES
ON TABLE Student
TO U2,U3;
~~~



收回权限REVOKE

REVOKE 语句的一般格式为： 

REVOKE < 权限 >[,< 权限 >]...  

[ON < 对象类型 > < 对象名 >] 

FROM < 用户 >[,< 用户 >]...;

~~~mysql
例 10 把用户 U5 对 SC 表的 INSERT 权限收回。

REVOKE INSERT
ON TABLE SC
FROM U5 cascade;
~~~

权限的**级联收回** 

系统将收回直接或间接从 U5 处获得的对 SC 表的 INSERT 权限 : -->U5--> U6--> U7 收回 U5 、 U6 、 U7 获得的对 SC 表的 INSERT 权 限 : <--U5<-- U6<-- U7



建设数据库模式的权限

对数据库模式的授权则由 DBA 在创建用户时实现 

CREATE USER 语句一般格式如下： 

~~~mysql
CREATE USER  
[WITH] [DBA | RESOURCE | CONNECT];
~~~

| 拥有的权限 | CREATE USER | CREATE SCHEMA | CREATE TABLE | 登录数据库，执行数据查询和操纵 |
| ---------- | ----------- | ------------- | ------------ | ------------------------------ |
| DBA        | √           | √             | √            | √                              |
| RESOURCE   | ×           | ×             | √            | √                              |
| CONNECT    | ×           | ×             | ×            | √，但必须拥有相关的权限        |



###  传播权限

通过角色来实现将一组权限授予一个用户。

* 首先创建一个角色R1

  * CREATE ROLE R1

* 然后使用 GRANT 语句，使得角色 R1 拥有 STUDENT 表得 SELECT, UPDATE, INSERT 权限

  * ~~~mysql
    GRANT SELECT, UPDATE, INSERT
    ON TABLE STUDENT
    TO R1
    ~~~

* 将这个角色授予王平，张明。使得他们具有角色 R1 所包含的全部权限

  * ~~~mysql
    GRANT R1 TO WANG ， ZHANG
    ~~~

* 也可以一次性通过 R1 回收王平的这三个权限

  * ~~~mysql
    REVOKE R1 FROM WANG ；
    ~~~
  
* 角色权限的修改

  * ~~~mysql
    GRANT DELETE
     ON TABLE STUDENT
     TO R1
    REVOKE SELECT
     ON TABLE STUDENT
     TO R1
    ~~~

# 二、视图机制

视图机制**把要保密的数据对无权存取这些数据的用户隐藏起来**，视图机制更主要的功能在于提供数据独立性，其安全保护功能太不精细，往往远不能达到应用系统的要求。

**视图机制与授权机制配合使用 **: 

* 首先用视图机制屏蔽掉一部分保密数据 
* 视图上面再进一步定义存取权限 
* 间接实现了支持存取谓词的用户权限定义



~~~mysql
例：WANG只能检索计算机系学生的信息
 
# 先建立计算机系学生的视图 CS_Student
CREATE VIEW CS_Student
AS 
 SELECT *
 FROM Student
 WHERE Sdept='CS'
 
# 在视图上进一步定义存取权限
GRANT SELECT
ON CS_Student 
TO WANG ； 

GRANT ALL PRIVILIGES
 ON CS_Student 
 TO ZHANG ；
~~~



# 三、审计

审计是启用一个专用的审计日志(Audit log)，**将用户对数据库的所有操作记录在上面**。**审计员利用审计日志监控数据库中的各种行为**，找出非法存取数据的人、时间和内容。

审计功能的可选性

* 审计很费时间和空间 

* DBA 可以根据应用对安全性的要求，灵活地打开或关闭审计功能 
* 审计功能主要用于安全性要求较高的部门

## 1、审计事件

* 服务器事件
  * 审计数据库服务器发生的事件
* 系统权限 
  * 对系统拥有的结构或模式对象进行操作的审计 
  * 要求该操作的权限是通过系统权限获得的  
* 语句事件 
  * 对 SQL 语句，如 DDL 、 DML 、 DQL 及 DCL 语句的审计 
* 模式对象事件 
  * 对特定模式对象上进行的 SELECT 或 DML 操作的审计



## 2、审计功能

* 基本功能：提供多种审计查阅方式提供多种审计查阅方式 
* 多套审计规则：一般在初始化设定 
* 提供审计分析和报表功能 
* 审计日志管理功能 
  * 防止审计员误删审计记录，审计日志必须先转储后删除 
  * 对转储的审计记录文件提供完整性和保密性保护 
  * 只允许审计员查阅和转储审计记录，不允许任何用户新增和修改审计记录等 
* 提供查询审计设置及审计记录信息的专门视图



## 3、审计语句

* AUDIT 语句：设置审计功能  

* NOAUDIT 语句：取消审计功能



* 用户级审计 
  * 任何用户可设置的审计 
  * 主要是用户针对自己创建的数据库表和视图进行审计 
* 系统级审计 
  * **只能由数据库管理员设置 **
  * 监测成功或失败的登录要求、监测授权和收回操作以 及其他数据库级权限下的操作



~~~mysql
[ 例 ] 对修改 SC 表结构或修改 SC 表数据的操作进行审计。
 
 AUDIT ALTER, UPDATE 
 ON SC;
~~~



# 四、数据加密

数据加密是防止数据库中数据在存储和传输中失密的有效手段。

根据一定的算法将**原始数据（术语为明文， Plain text ）**变换为不可直接识别的格式**（术语为密文， Cipher text ）**，不知道解密算法的人无法获知数据的内容。

加密方法

* 替换方法 
  * 使用**密钥（ Encryption Key ）**将明文中的每一个字符转换为密文中的一个字符 
* 置换方法 
  * 将明文的字符按不同的顺序重新排列 
* 混合方法 
  * 美国 1977 年制定的官方加密标准：**数据加密标准（ Data  Encryption Standard ，简称 DES ）**

![](img\DBMS可信传输.jpg)

基于安全套接层协议 SSL 传输方案的实现思路

* 确认通信双方端点的可靠性 
  * 采用**基于数字证书的服务器和客户端认证方式 **
  * 通信时均首先向对方提供己方证书，然后使用本地的 CA 信任列表和证书撤销列表对接收到的对方证书进行验证 
* 协商加密算法和密钥 
  * 确认双方端点的可靠性后，通信双方协商本次会话的加密算法与密钥
* 可信数据传输
  * 业务数据在被发送之前将被用某一组特定的密钥进行加密和消息摘要计算，**以密文形式在网络上传输** 
  * 当业务数据被接收的时候，需用相同一组特定的密钥进行**解密和摘要计算**

注意

以下字段不宜加密

* 索引字段
* 关系运算的比较字段
* 表间的连接码字段





## 练习

[第4章 数据库安全性 | 数据库知识点整理 - Kevin_Lu - 博客园 (cnblogs.com)](https://www.cnblogs.com/kaml8/p/12131614.html)

# 五、统计数据库安全性

统计数据库的特点

* 允许用户查询**聚集类型**的信息（例如合计、平均值等） 

* **不允许查询单个记录信息**

~~~
例：允许查询“程序员的平均工资是多少？”
 不允许查询“程序员张勇的工资？”
~~~

统计数据库中特殊的安全性问题 

* 隐蔽的信息通道 

* 从合法的查询中推导出不合法的信息

~~~mysql
例 1 ：下面两个查询都是合法的：
1 ．本公司共有多少女高级程序员？
2 ．本公司女高级程序员的工资总额是多少？
 
 如果第一个查询的结果是“ 1”，那么第二个查询的结果显然就是这个程序员的工资
数。

例 2 ：用户 A 发出下面两个合法查询：
1 ．用户 A 和其他 N 个程序员的工资总额是多少？
2 ．用户 B 和其他 N 个程序员的工资总额是多少？

若第一个查询的结果是 X ，第二个查询的结果是 Y ，
由于用户 A 知道自己的工资是 Z ，那么他可以计算出用户 B 的工资 =Y-(Audit)X-Z) 。
 原因：两个查询之间有很多重复的数据项
~~~

规则 1 ：任何查询至少要**涉及 N(N 足够大 ) 个以上的记录**

规则 2 ：任意两个查询的**相交数据项不能超过 M 个**

规则 3 ：任一用户的**查询次数不能超过 1+(N-2)/M **

数据库安全机制的设计目标： 试图破坏安全的人所花费的代价 >> 得到利益
