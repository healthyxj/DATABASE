# SQL

数据库可以用于存储数据、检索数据和生成新数据

数据表，一种数据表对应一种类型的数据；例如生成顾客表和订单表。

数据表是由行和列组成的二维表。行称为记录，表中的数据是按行存储的，使用时不允许字段为空值。列也称为字段。

主键，是用于处理信息冗余的。将冗余的信息提取到一个新的表中，创建主键用于指导冗余的数据。关联到其他表主键的字段称为外键。

第二章、关系操作

关系操作包括

* 集合运算(针对集合)
  * 交，指求交集，∩
  * 并，指求并集，∪
  * 差，求差集，如R-S，表示属于R但不属于S的元素
  * 笛卡尔积，将两个表格中的所有行排列组合的方法，类似于矢量的乘法
* 关系运算(针对表)
  * 选择，σ，<b>从行的角度</b>对原表进行操作
  * 投影，Π，<b>从列的角度</b>对原表进行操作
  * 除，从行和列的角度进行运算。从“被除表格”中调取“除表格”包含的所有行，然后再除去“除表格“中的内容
  * 连接
    * 内连接(inner join)，类似于交集
    * 外连接(包括左外连接、右外连接、全外连接)，类似于并集，左外连接是三部分中最左边的部分；全外连接是并集的部分
    * 交叉连接

补充：

选择 σ条件(关系名)；外连接：把舍弃的元组也保存在结果关系中，在其他属性上填空值(null)

 

第三章、基础查询

SQL，数据库由数据库管理系统(DBMS)操纵和管理，用户通过数据库管理系统访问数据库中的数据。数据库管理的是表，数据以表格的形式存储在数据库中。数据库管理员(DBA)管理数据库，通过SQL语言管理数据库。

SQL的特点

* 不是某个数据库专有的语言，学完SQL后可以与几乎所有的数据库打交道
* SQL简洁，完成核心功能只用了9个动词
* SQL可以进行非常复杂和高级的数据库操作



SQL语言的分类

SQL语言包括三部分

* 数据定义语言 DDL，用于创建表、视图、索引
* 数据操作语言 DML，用于增、删、查、改
* 数据控制语言 DCL，用于分配权限

各个语言的关键词

1、数据定义语言 DDL

|          |      操作       |      方       |     式      |
| :------: | :-------------: | :-----------: | :---------: |
| 操作对象 |      创建       |     删除      |    修改     |
|  数据库  | CREATE DATABASE | DROP DATABASE |             |
|    表    |  CREATE TABLE   |  DROP TABLE   | ALTER TABLE |
|   索引   |  CREATE INDEX   |  DROP INDEX   |             |
|   视图   |   CREATE VIEW   |   DROP VIEW   |             |

2、数据操作语言 DML

|    --    | 操作方式 | 操作方式 | 操作方式 | 操作方式 |
| :------: | :------: | :------: | :------: | :------: |
| 操作对象 |   增加   |   删除   |   修改   |   查询   |
|   记录   |  insert  |  delete  |  update  |  select  |

增

insert

* 操作：插入单行数据
* 语法：insert into 表名 (列名) values (列值)
* 案例：insert into Students (姓名，性别，出生日期) values ('王伟华','男',1983/6/15)，表示增加了一行，王伟华，性别男，出生日期是……

insert,select

* 操作：使用insert,select语句将现有表中的数据添加到已有的新表中
* 语法：insert into 已有的新表 (列名) /n select 原表列名 from 原表名
* 案例：insert into addressList(''姓名'',''地址'',"电子邮件") /n select name,address,email from Students

删

delete

* 操作：使用delete删除表中某行数据
* 语法：delete from 表名 where 删除条件
* 案例：delete from a where name='王伟华' ，表示删除表a中<b>列值为王伟华</b>的行

truncate

* 操作：使用truncate table删除表
* 语法：truncate  table 表名
* 案例：truncate table addressList

改

update

* 操作：使用update更新修改数据
*  语法：update 表名 set 列名=更新值 where 更新条件
* 案例：update addressList set 年龄=18 where 姓名=’王伟华‘

查 

select

* 操作：使用select查询数据，查询多个列要用逗号将列与列隔开（顺序不重要）
* 语法：select 列名 from 表名
* 案例：select city from students
* select * from 表名称，查询所有列

注意事项：select *要尽量避免使用，防止资源的浪费；select student.姓名,select student.性别 from student可以简化为select 姓名，性别 from student

select完整语句select 列名称 [into 新表名] from 表 [where 查询条件] [group by 分组表达式] [having 分组条件] [order by 列名[asc|desc]]

使用[计算列]

| id   | name  | price |
| ---- | ----- | ----- |
| 1    | apple | 3     |
| 2    | pear  | 4     |

1、对fruit表中的所有价格(price)进行求和

select sum(price) from fruit

查询结果是7.0

2、查询fruit表中字段价格的个数

select count(price) from fruit

查询结果是2，有两种价格

3、查询价格提升50%后的信息

select price*1.05 from fruit

结果是

SQL对大小写不敏感



查询是所有的关键

查看单列 select col

查看多列 select col1, col2

查看列，并去除重复值 select distinct col

计算列 

order by作用于单个或多个字段，默认是升序排序；加desc可以实现降序排列；作用于空值null，将空值null放在最后

3、数据控制语言DCL

|    --    | 操作方式 | 操作方式 |
| :------: | :------: | :------: |
| 操作对象 | 增加权限 | 删除权限 |
|  数据库  |  grant   |  revoke  |



现实世界中客观对象的抽象过程

建模(由数据库设计人员完成)转变为机器世界中的数据。

| 现实世界 | 信息世界 | 数据世界 |
| :------: | :------: | :------: |
|  事物类  |  实体集  |   文件   |
|   事物   |   实体   |   记录   |
|   性质   |   属性   |  数据项  |

有现实世界转变为信息世界为第一类模型，称为概念模型；由信息世界转变为数据世界是第二类模型，称为数据模型。



数据模型的组成要素

* 数据结构：一个模型中有什么样的对象，对象的内容是什么
* 数据操作
  * 包括查询(最常用)和更新
* 完整性约束条件（一组规则）
  * 实体完整性（<b>不能存在完全相同的记录，每条记录有不重复的主键，主键不能为空值</b>）
  * 域完整性（输入数据的范围要有效 ）
  * 参照完整性（当一个表引用了另一个表中的某些数据时，相关字段的值要保持一致，通俗地说，外表中的外键值必须是主表中存在的值）



概念模型的介绍

实体：具体的人、事或抽象的概念，实体是用矩形框表示，并且要写上具体的名字。

属性：实体具有的具体的特性。

联系包括实体内部的联系（组成实体的各属性之间），也包括实体之间的联系。

实体-联系方法(E-R方法)：将实体、属性、联系的方法整合起来描述现实世界。<b>实体-矩形框；属性-椭圆；联系-菱形。</b>

关系模型

用二维表格表示一个实体集，就是关系模型。一个表格对应一个关系。

关系术语

关系名：表名

关系模式：表格的表头

元组：表中的一行

分量：元组中的每一个属性值

属性：表中的一列

属性名：给表中的属性起个名称就是属性名

将E-R图转化为关系模型

转化原则

确保每个实体转化为一个关系；将每个联系也转化为一个关系；

将一个实体的属性值添加到另一个实体or<b>将少端实体的主键添加到多端实体的主键中</b>。

